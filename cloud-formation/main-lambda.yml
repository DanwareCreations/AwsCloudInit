AWSTemplateFormatVersion: 2010-09-09

Description: An S3 bucket for Lambda functions, and IAM principals for managing Lambda in the AWS account

Metadata:
  AWS::CloudFormation::Interface: 
    ParameterGroups:
    -
      Parameters:
      - OrganizationPrefix
      - LogBucketName
      - KmsAdminUserName

Parameters:
  OrganizationPrefix:
    Type: String
    Default: mycompany
    AllowedPattern: ^[\w+=,.@-]*$
    Description: A prefix to append to all bucket names and IAM principals (e.g., "mycompany")
    ConstraintDescription: "must be a string of upper and lowercase alphanumeric characters with no spaces, and any of the following characters: =,.@-.  Note that group names are not distinguished by case."
  LogBucketName:
    Type: String
    Default: mycompany-region-logs
    AllowedPattern: ^[a-z0-9.-]+$
    Description: The name of the bucket to which the Lambda-function S3 bucket will store logs.
    ConstraintDescription: must contain only lowercase letters, numbers, periods (.), and dashes (-).

Resources:
  # S3 bucket for Lambda functions
  LambdaBucket:
    Type: AWS::S3::Bucket
    Properties: 
      AccessControl: PublicRead
      BucketName: !Join [ "-", [ !Ref OrganizationPrefix, !Ref "AWS::Region", lambda ] ]
      LoggingConfiguration:
        DestinationBucketName: !Ref LogBucketName
        LogFilePrefix: lambda/
        
Outputs:
  LambdaS3Bucket:
    Value: !Ref LambdaBucket
    Description: Name of the new S3 bucket for Lambda deployment packages.
    Export: { Name: LambdaS3Bucket }